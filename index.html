<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodMate - Productivity & Mood Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            height: 80px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .logs-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .log-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .log-date {
            font-weight: bold;
            color: #333;
        }

        .log-mood {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .mood-happy { background: #d4edda; color: #155724; }
        .mood-sad { background: #d1ecf1; color: #0c5460; }
        .mood-angry { background: #f8d7da; color: #721c24; }
        .mood-anxious { background: #e2e3e5; color: #383d41; }
        .mood-calm { background: #d1ecf1; color: #0c5460; }
        .mood-excited { background: #fff3cd; color: #856404; }
        .mood-tired { background: #e2e3e5; color: #383d41; }
        .mood-neutral { background: #f8f9fa; color: #6c757d; }

        .log-productivity {
            color: #667eea;
            font-weight: bold;
        }

        .log-note {
            color: #666;
            font-style: italic;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .suggestions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .suggestion-item {
            margin-bottom: 8px;
            padding-left: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ MoodMate Tracker</h1>
            <p>Track your daily mood & productivity</p>
        </div>

        <div class="app-container">
            <!-- Left Column -->
            <div>
                <!-- Add Log Form -->
                <div class="card">
                    <h2>üìù Add Daily Log</h2>
                    <form id="logForm">
                        <div class="form-group">
                            <label for="date">Date:</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label for="mood">Mood:</label>
                            <select id="mood" required>
                                <option value="">Select mood</option>
                                <option value="happy">üòä Happy</option>
                                <option value="sad">üò¢ Sad</option>
                                <option value="angry">üò† Angry</option>
                                <option value="anxious">üò∞ Anxious</option>
                                <option value="calm">üòå Calm</option>
                                <option value="excited">ü§© Excited</option>
                                <option value="tired">üò¥ Tired</option>
                                <option value="neutral">üòê Neutral</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productivity">Productivity (1-10):</label>
                            <input type="number" id="productivity" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label for="note">Note:</label>
                            <textarea id="note" placeholder="How was your day?"></textarea>
                        </div>
                        <button type="submit" class="btn">Save Log</button>
                    </form>
                </div>

                <!-- Summary -->
                <div class="card">
                    <h2>üìä Summary</h2>
                    <div id="summaryContent">
                        <div class="loading">Loading summary...</div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Insights -->
                <div class="card">
                    <h2>üîç Insights</h2>
                    <div id="insightsContent">
                        <div class="loading">Loading insights...</div>
                    </div>
                </div>

                <!-- Logs List -->
                <div class="card">
                    <h2>üìã Your Logs</h2>
                    <div id="logsContent">
                        <div class="loading">Loading logs...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h2>Edit Log</h2>
            <form id="editForm">
                <input type="hidden" id="editIndex">
                <div class="form-group">
                    <label for="editDate">Date:</label>
                    <input type="date" id="editDate" required>
                </div>
                <div class="form-group">
                    <label for="editMood">Mood:</label>
                    <select id="editMood" required>
                        <option value="happy">üòä Happy</option>
                        <option value="sad">üò¢ Sad</option>
                        <option value="angry">üò† Angry</option>
                        <option value="anxious">üò∞ Anxious</option>
                        <option value="calm">üòå Calm</option>
                        <option value="excited">ü§© Excited</option>
                        <option value="tired">üò¥ Tired</option>
                        <option value="neutral">üòê Neutral</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductivity">Productivity (1-10):</label>
                    <input type="number" id="editProductivity" min="1" max="10" required>
                </div>
                <div class="form-group">
                    <label for="editNote">Note:</label>
                    <textarea id="editNote"></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn">Update Log</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupEventListeners();
            
            // Set today's date as default
            document.getElementById('date').valueAsDate = new Date();
        });

        function setupEventListeners() {
            document.getElementById('logForm').addEventListener('submit', addLog);
            document.getElementById('editForm').addEventListener('submit', updateLog);
        }

        async function loadAllData() {
            await Promise.all([
                loadLogs(),
                loadSummary(),
                loadInsights()
            ]);
        }

        async function loadLogs() {
            try {
                const response = await fetch(`${API_BASE}/logs`);
                const logs = await response.json();
                displayLogs(logs);
            } catch (error) {
                document.getElementById('logsContent').innerHTML = 
                    '<div class="error">Failed to load logs</div>';
            }
        }

        async function loadSummary() {
            try {
                const response = await fetch(`${API_BASE}/summary`);
                const summary = await response.json();
                displaySummary(summary);
            } catch (error) {
                document.getElementById('summaryContent').innerHTML = 
                    '<div class="error">Failed to load summary</div>';
            }
        }

        async function loadInsights() {
            try {
                const response = await fetch(`${API_BASE}/insights`);
                const insights = await response.json();
                displayInsights(insights);
            } catch (error) {
                document.getElementById('insightsContent').innerHTML = 
                    '<div class="error">Failed to load insights</div>';
            }
        }

        function displayLogs(logs) {
            const container = document.getElementById('logsContent');
            
            if (!logs || logs.length === 0) {
                container.innerHTML = '<p>No logs yet. Add your first log above!</p>';
                return;
            }

            container.innerHTML = logs.map((log, index) => `
                <div class="log-item">
                    <div class="log-header">
                        <span class="log-date">${log.date}</span>
                        <span class="log-mood mood-${log.mood}">${log.mood.toUpperCase()}</span>
                    </div>
                    <div class="log-productivity">Productivity: ${log.productivity}/10</div>
                    <div class="log-note">${log.note || 'No note'}</div>
                    <div style="margin-top: 10px;">
                        <button class="btn" onclick="openEditModal(${index})" style="padding: 5px 10px; font-size: 12px;">Edit</button>
                        <button class="btn btn-danger" onclick="deleteLog(${index})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function displaySummary(summary) {
            const container = document.getElementById('summaryContent');
            
            if (summary.error) {
                container.innerHTML = `<p>${summary.error}</p>`;
                return;
            }

            container.innerHTML = `
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-value">${summary.total_entries}</div>
                        <div class="stat-label">Total Entries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${summary.average_productivity}</div>
                        <div class="stat-label">Avg Productivity</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${summary.most_common_mood}</div>
                        <div class="stat-label">Common Mood</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${summary.most_productive_day}</div>
                        <div class="stat-label">Best Day</div>
                    </div>
                </div>
                <h3>Mood Distribution</h3>
                <div>
                    ${Object.entries(summary.mood_distribution || {}).map(([mood, count]) => `
                        <div>${mood}: ${count} times</div>
                    `).join('')}
                </div>
            `;
        }

        function displayInsights(insights) {
            const container = document.getElementById('insightsContent');
            
            if (insights.error) {
                container.innerHTML = `<p>${insights.error}</p>`;
                return;
            }

            container.innerHTML = `
                <div class="stat-card" style="margin-bottom: 15px;">
                    <div class="stat-value">${insights.average_recent_productivity}</div>
                    <div class="stat-label">This Week's Productivity</div>
                </div>
                ${insights.suggestions && insights.suggestions.length > 0 ? `
                    <div class="suggestions">
                        <h3>üí° Suggestions</h3>
                        ${insights.suggestions.map(suggestion => `
                            <div class="suggestion-item">${suggestion}</div>
                        `).join('')}
                    </div>
                ` : '<p>Keep up the good work!</p>'}
            `;
        }

        async function addLog(event) {
            event.preventDefault();
            
            const formData = {
                date: document.getElementById('date').value,
                mood: document.getElementById('mood').value,
                productivity: document.getElementById('productivity').value,
                note: document.getElementById('note').value
            };

            try {
                const response = await fetch(`${API_BASE}/logs`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Log added successfully!');
                    document.getElementById('logForm').reset();
                    document.getElementById('date').valueAsDate = new Date();
                    loadAllData();
                } else {
                    alert(`Error: ${result.error}`);
                }
            } catch (error) {
                alert('Failed to add log. Please try again.');
            }
        }

        function openEditModal(index) {
            fetch(`${API_BASE}/logs`)
                .then(response => response.json())
                .then(logs => {
                    const log = logs[index];
                    document.getElementById('editIndex').value = index;
                    document.getElementById('editDate').value = log.date;
                    document.getElementById('editMood').value = log.mood;
                    document.getElementById('editProductivity').value = log.productivity;
                    document.getElementById('editNote').value = log.note;
                    document.getElementById('editModal').style.display = 'flex';
                });
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        async function updateLog(event) {
            event.preventDefault();
            
            const index = document.getElementById('editIndex').value;
            const formData = {
                date: document.getElementById('editDate').value,
                mood: document.getElementById('editMood').value,
                productivity: document.getElementById('editProductivity').value,
                note: document.getElementById('editNote').value
            };

            try {
                const response = await fetch(`${API_BASE}/logs/${index}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Log updated successfully!');
                    closeModal();
                    loadAllData();
                } else {
                    alert(`Error: ${result.error}`);
                }
            } catch (error) {
                alert('Failed to update log. Please try again.');
            }
        }

        async function deleteLog(index) {
            if (!confirm('Are you sure you want to delete this log?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/logs/${index}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Log deleted successfully!');
                    loadAllData();
                } else {
                    alert(`Error: ${result.error}`);
                }
            } catch (error) {
                alert('Failed to delete log. Please try again.');
            }
        }
    </script>
</body>
</html>